<!DOCTYPE html>
<html lang="ru">
<head>
    {% load static %}
    <meta charset="UTF-8" />
    <title>Мои заявки</title>
    <link rel="stylesheet" href="{% static 'styling/base.css' %}" />
    <link rel="stylesheet" href="{% static 'styling/components.css' %}" />
    <link rel="stylesheet" href="{% static 'styling/style.css' %}" />
    <link rel="stylesheet" href="{% static 'styling/layout.css' %}" />
    <link rel="stylesheet" href="{% static 'styling/nav.css' %}" />
    <link rel="stylesheet" href="{% static 'styling/inline-edit.css' %}" />
</head>
<body>
    <header>
        <h1>Название</h1>
        {% if user.is_authenticated %}
          <p class="user-greeting">Привет, {{ user.username }}!</p>
          <nav>
            <form method="post" action="{% url 'logout' %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn btn-logout" type="submit">Выйти</button>
            </form>
            <!-- Navigation links -->
              <a href="{% url 'home' %}" class="btn-link">Главная</a>
            <a href="{% url 'profile' %}" class="btn-link">Профиль</a>
            <a href="{% url 'requests' %}" class="btn-link">Мои заявки</a>
            <a href="{% url 'available_requests' %}" class="btn-link">Доступные заявки</a>
            <a href="{% url 'request' %}" class="btn-link">Новая заявка</a>
          </nav>
        {% else %}
          <nav>
            <a href="{% url 'register' %}" class="btn-link">Регистрация</a>
            <a href="{% url 'login' %}" class="btn-link">Вход</a>
          </nav>
        {% endif %}
    </header>

    <main class="page-main">
        <div class="content-wrapper">
            <div class="page-header">Мои заявки</div>
            <div class="requests-container">
                {% if created_requests %}
                    {% for req in created_requests %}
                        <div class="request-card" data-request-id="{{ req.id }}">
                            <button class="delete-btn" aria-label="Удалить заявку" title="Удалить заявку">&times;</button>

                            <div class="request-title">
                                <span class="editable"
                                      data-field="book_name"
                                      data-request-id="{{ req.id }}">{{ req.book_name }}</span>
                            </div>
                            <div class="request-info">
                                Дата подачи: {{ req.date_created|date:"d.m.Y" }}
                            </div>
                            <div class="request-info">
                                Дата обмена:
                                <span class="editable"
                                      data-field="date_exchange"
                                      data-request-id="{{ req.id }}">{{ req.date_exchange|date:"d.m.Y" }}</span>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>У вас пока нет заявок.</p>
                {% endif %}
            </div>
            <div class="edit-hint">
                Нажмите на название книги или дату обмена, чтобы изменить
            </div>
        </div>
        <div class="content-wrapper">
            <div class="page-header">Принятые заявки</div>
            <div class="requests-container">
                {% if accepted_requests %}
                        {% for req in accepted_requests %}
                            <div class="request-card" data-request-id="{{ req.id }}">
                                <div class="request-title">Название книги: {{ req.book_name }}</div>
                                <div class="request-info">Пользователь: {{ req.user.username }}</div>
                                {% if req.user.profile.genre %}
                                    <div class="request-info">
                                        Жанр: {{ req.user.profile.get_genre_display }}
                                    </div>
                                {% endif %}
                                {% if req.user.profile.groupsize %}
                                    <div class="request-info">
                                        Подписчики: {{ req.user.profile.get_groupsize_display }}
                                    </div>
                                {% endif %}

                                {% if req.user.profile.author_page_link %}
                                    <div class="request-info">
                                      <a href="{{ req.user.profile.author_page_link }}" target="_blank" class="author-page-link-btn">Перейти</a>
                                    </div>
                                {% endif %}

                                <div class="request-info">Дата обмена: {{ req.date_exchange }}</div>
                                <div class="request-info">Дата подачи: {{ req.date_created }}</div>

                                <form method="post" action="{% url 'toggle-save-request' req.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-secondary">Отменить заявку</button>
                                </form>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>У вас пока нет принятых заявок.</p>
                    {% endif %}
            </div>
        </div>
    </main>

    <script src="{% static 'scripts/inline-edit.js' %}"></script>
</body>
</html>
